/*
 * شبیه‌ساز «قطار نور» (Light Train) در ترمینال
 *
 * توضیح:
 *   در این برنامه یک «قطار» متشکل از چند نقطه‌ی روشن (مشخص شده با کاراکتر 'O')
 *   داریم که در قالب یک بایت ۸بیتی (uint8_t) تعریف می‌شود.
 *   هر بیتِ ۱ در آن بایت، معادل یک نقطه‌ی روشن است. با هر تکرار حلقه، این بایت
 *   یک موقعیت به چپ شیفت داده می‌شود (<< 1). وقتی تمامِ ۱ها از بایت خارج شوند
 *   و مقدار صفر شود، دوباره به الگوی اولیه برمی‌گردد تا حرکتِ گردشی شکل بگیرد.
 *
 *   برای رسمِ قطار، بایت را از بیت شماره ۷ (بیشترین وزن) تا بیت ۰ پیمایش می‌کنیم
 *   و اگر هر بیت برابر ۱ بود، کاراکتر 'O' چاپ می‌کنیم و در غیر این صورت یک فاصله.
 *   با ترکیب ANSI Escape Code صفحه پاک می‌شود و الگو به‌روزرسانی می‌شود تا حرکت
 *   نقطه‌ها (قطار) شبیه‌سازی شود.
 *
 *   نکته: usleep برای تأخیر بین فریم‌ها استفاده شده است. اگر در سیستم شما
 *   usleep در واحد میکروثانیه کار نمی‌کند می‌توانید از sleep یا معادل دیگری استفاده کنید.
 */

#include <stdio.h>
#include <stdint.h>
#include <unistd.h>   // برای usleep()
#include <stdlib.h>

#define WIDTH 8                 // تعداد بیت در «قطار» (یک بایت)
#define INIT_TRAIN 0b00001111   // الگوی اولیه: سه نقطه‌ی پشت‌سرهم در لبهٔ راست

int main() {
    uint8_t train = INIT_TRAIN;
    int i;

    while (1) {
        // ---------- 1. پاک کردن صفحه (ANSI Escape Code) ----------
        // \e[H: نشانگر را به گوشهٔ بالا-چپ صفحه می‌برد
        // \e[J: کل صفحه را از مکان جاری تا پایان پاک می‌کند
        printf("\e[H\e[J");

        // ---------- 2. رسم «قطار» در یک سطر ----------
        // از بیت شماره 7 (چپ‌ترین) تا بیت 0 (راست‌ترین) بررسی می‌کنیم
        for (i = WIDTH - 1; i >= 0; i--) {
            if (train & (1 << i)) {
                // اگر بیت i ام برابر 1 باشد، «قطار» (نقطه‌ی نور) را چاپ کن
                printf("$");
            } else {
                // در غیر این صورت یک فاصله خالی چاپ کن
                printf(" ");
            }
        }
        printf("\n");

        // ---------- 3. تأخیر برای مشاهدهٔ حرکت قطار ----------
        usleep(200000);  // 200000 میکروثانیه = 0.2 ثانیه

        // ---------- 4. شیفت چپِ بایتِ train ----------
        train <<= 1;

        // اگر تمامِ بیت‌ها خارج شدند و train صفر شد، دوباره به الگوی اولیه برگرد
        if (train == 0) {
            train = INIT_TRAIN;
        }
    }

    return 0;
}
